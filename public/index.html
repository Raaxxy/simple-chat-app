<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Chat App</h1>
        </div>
        <div class="chat-body">
            <div class="chat-sidebar">
              <!-- Sidebar content (user list, etc.) -->
              <h2 id="online-users">Online Users</h2>
                <ul id="user-list">
                <!-- Online user names will be displayed here -->
                </ul>
            </div>
            <div class="chat-main">
                <div class="chat-messages">
                    <!-- Messages will be displayed here -->
                </div>
                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="Type a message">
                    <button id="send">Send</button>
                </div>
            </div>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Connect to the Socket.io server
        const socket = io();

        // Request user's name when connecting
        let userName;
        do {
            userName = prompt("Please enter your name:");
        } while (!userName || userName.trim() === ''); // Continue prompting until a non-null and non-empty name is entered
        
        socket.emit('register-name', userName);

        socket.on('update-users', (userList) => {
        // Display the number of online users
        $('#online-users').text(`Online Users (${userList.length})`);

        // Display the list of online users
        $('#user-list').empty();
        userList.forEach(user => {
          const displayName = user === userName ? `${user} (you)` : user;
          $('#user-list').append($('<div class="message">').text(displayName));
        });
      });

        $('#messageInput').keydown((event) => {
            if (event.which === 13) { // Check if the key pressed is "Enter" (key code 13)
                const message = $('#messageInput').val();
                socket.emit('message', message);
                $('#messageInput').val('');
                event.preventDefault(); // Prevent the default Enter key behavior (e.g., adding a new line)
            }
        });
        // Define a dictionary of word-to-emoji pairs
        const wordToEmoji = {
            lol: '😂',
            hey: '👋',
            woah: '😮',
            like: '❤️',
            react: '☸',
            congratulations: '👏'
        };
        // Handle sending messages
        $('#send').click(() => {
            const message = $('#messageInput').val();
            socket.emit('message', message);
            $('#messageInput').val('');
        })

        // Handle receiving messages

        socket.on('message', (data) => { 
            let messageText = data.message;
            Object.keys(wordToEmoji).forEach(word => {
                const emoji = wordToEmoji[word];
                const regex = new RegExp(`\\b${word}\\b`, 'gi'); // Match whole words only
                messageText = messageText.replace(regex, emoji);
            });
            const messageWithUser = data.user ? `${data.user}: ${messageText}` : messageText;
            const messageClass = data.user === userName ? 'sent' : 'received'; // Check if the message is sent by the current user
            $('.chat-messages').append($('<div class="message">').addClass(messageClass).text(messageWithUser));
        });
    </script>
</body>
</html>
